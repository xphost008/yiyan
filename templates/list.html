<!-- 声明文档类型为HTML5，告知浏览器使用HTML5标准解析页面 [[3]][[8]][[9]] -->
<!DOCTYPE html>
<!-- 设置页面语言为中文，辅助浏览器翻译和搜索引擎优化 [[4]][[6]] -->
<html lang="zh">
<head>
    <!-- 定义字符编码为UTF-8，确保正确显示中文字符（HTML5唯一有效编码） [[5]][[10]] -->
    <meta charset="UTF-8">
    <!-- 设置页面标题，显示在浏览器标签栏 -->
    <title>一言列表</title>
    <!-- 链接外部CSS样式表，实现样式与结构分离 [[1]] -->
    <link href="/static/css/styles.css" rel="stylesheet">
    <!-- 内联CSS样式定义 -->
    <style>
        /* 内容容器样式：垂直滚动、弹性布局居中 [[7]] */
        #content {
            overflow-y: auto;
            display: flex;
            align-items: center;
            flex-direction: column;
        }

        /* 列表项样式：固定尺寸、模糊背景、圆角过渡效果 */
        .hit-item {
            width: 800px;
            height: 200px;
            margin-top: 40px;
            backdrop-filter: blur(10px);
            background-color: rgba(0, 0, 0, 0.6);
            border-radius: 20px;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        /* 悬停放大效果 */
        .hit-item:hover {
            transform: scale(105%);
        }

        /* 最后一个列表项底部边距 */
        .hit-item:last-child {
            margin-bottom: 20px;
        }

        /* 标题样式：内边距控制布局 */
        .hit-title {
            width: 740px;
            height: 100px;
            padding: 15px 30px 30px 30px;
        }

        /* 信息区域左浮动布局 */
        .hit-info {
            float: left;
            line-height: 40px;
            margin-left: 30px;
        }

        /* 点赞按钮右浮动，颜色过渡效果 */
        .hit-like {
            float: right;
            margin-right: 30px;
            line-height: 40px;
            transition: all 0.2s;
        }
    </style>
</head>
<body>
<!-- Vue应用挂载点 -->
<div id="app">
    <div id="box">
        <!-- 导航栏容器 -->
        <div id="navbar">
            <!-- 导航链接：隐私政策、登录等 -->
            <a class="nav-button-style cursor-pointer" href="/privacy">隐私政策</a>
            <a class="nav-button-style cursor-pointer" href="/login">点我登录</a>
            <a class="nav-button-style cursor-pointer" href="/submit">发表一言</a>
            <a class="current-page" href="/list">一言列表</a>
            <a class="nav-button-style cursor-pointer" href="/my">我的提交</a>
            <a class="nav-button-style cursor-pointer" href="/">&nbsp;&nbsp;&nbsp;&nbsp;首页&nbsp;&nbsp;&nbsp;&nbsp;</a>
        </div>
        <!-- 内容区域：使用Vue循环渲染列表 -->
        <div id="content">
            <!-- v-for指令循环生成列表项 -->
            <div class="hit-item" v-for="(list, index) in lists">
                <!-- 标题显示 -->
                <h1 class="hit-title font-songti">{{list['content']}}</h1>
                <div style="font-size: 20px; font-weight: bold">
                    <!-- 信息展示：ID、分类、来源、作者 -->
                    <p class="hit-info">ID: {{list['id']}} | 分类：{{choose(list['classifiers'])}} | 来源：{{list['source']}} | 作者：{{list['author']}}</p>
                    <!-- 点赞按钮：动态颜色和点击事件 -->
                    <p class="hit-like cursor-pointer" 
                       :style="'color: ' + (list['isLike'] ? 'red' : 'white') + ';'" 
                       @click="like(index)">
                        ♥ {{list['likes']}}
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 引入Axios库用于HTTP请求 -->
<script src="/static/js/axios.js"></script>
<!-- 引入Vue3核心库 -->
<script src="/static/js/vue3.js"></script>
<script>
    // 解构Vue3的API
    const {createApp, reactive, onMounted} = Vue;
    createApp({
        setup() {
            // 响应式数据：存储一言列表
            const lists = reactive([])
            
            // 分类转换函数：将英文分类转为中文
            function choose(classifiers) {
                switch(classifiers) {
                    case 'anime': return '动画'
                    case 'comic': return '漫画'
                    case 'game': return '游戏'
                    case 'literature': return '文学'
                    case 'myself': return '原创'
                    case 'internet': return '来自网络'
                    case 'other': return '其他'
                    case 'video': return '影视'
                    case 'poem': return '诗词'
                    case 'ncm': return '网易云'
                    case 'philosophy': return '哲学'
                    case 'funny': return '抖机灵'
                }
            }
            
            // 获取所有一言数据
            function get_all() {
                axios.get("/yiyan/get_all").then(res => {
                    res.data.forEach(item => {
                        lists.push({
                            id: item.id,
                            content: item.content,
                            source: item.source,
                            classifiers: item.classifiers,
                            author: item.author,
                            likes: parseInt(item.likes),
                            isLike: item.is_liked
                        })
                    })
                }).catch(err => console.log(err))
            }

            // 点赞处理函数
            async function like(id) {
                axios.post("/yiyan/like", {id: lists[id].id, is_liked: lists[id].isLike})
                    .then(res => {
                        if (res.data === "ok") {
                            // 切换点赞状态并更新计数
                            lists[id].isLike = !lists[id].isLike
                            lists[id].likes += lists[id].isLike ? 1 : -1
                        } else if (res.data === "nologin") {
                            window.location.href = "/login" // 未登录跳转
                        } else if (res.data === "my") {
                            alert("不能为自己点赞") // 自己的内容禁止点赞
                        }
                    }).catch(err => console.log(err))
            }

            // 生命周期钩子：组件挂载后获取数据
            onMounted(() => {
                get_all()
            })
            
            // 暴露给模板使用的数据和方法
            return {lists, get_all, like, choose}
        }
    }).mount("#app") // 挂载Vue实例
</script>
<!-- 引入自定义鼠标效果脚本 -->
<script src="/static/js/mouse.js"></script>
</body>
</html>
